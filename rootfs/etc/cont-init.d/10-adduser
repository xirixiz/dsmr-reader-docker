#!/usr/bin/with-contenv bash

function _check_device() {
  if ls /dev/ttyUSB* 1>/dev/null 2>&1; then
    chmod 666 /dev/ttyUSB*
  fi
}

_check_device

DUID=${DUID:-803}
DGID=${DGID:-803}

groupmod -o -g "${DGID}" app
usermod -o -u "${DUID}" app

echo "
-------------------------
User UID: $(id -u app)
User GID: $(id -g app)
-------------------------
"

time32="$(date +%Y)"

if [[ "${time32}" == "1970" || "${time32}" == "1969" ]] && [ "$(uname -m)" == "armv7l" ]; then
  echo 'Your DockerHost is running an outdated version of libseccomp. Search internet to fix this!'
  sleep infinity
fi

adduser app dialout
chown -R app:app /app
chown -R app:app /config
chown -R app:app /defaults
